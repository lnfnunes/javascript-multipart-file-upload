function Observable(){Object.call(this),this.handlers=[]}function XHR(e){Object.call(this),this.apply(this.item,e)}function Queue(){Object.call(this),this.dataStore=[]}function Stack(){Object.call(this),this.dataStore=[]}Observable.prototype=Object.create(Object.prototype,{constructor:Observable,init:{value:function(){},enumerable:!1,configurable:!0,writable:!1},apply:{value:function(e,t){for(var r in t)e[r]=t[r]},enumerable:!1,configurable:!1,writable:!1},handlers:{writable:!0,configurable:!0,value:null},subscribe:{value:function(e){this.handlers.push(e)},enumerable:!1,configurable:!1,writable:!1},publish:{value:function(e,t){this.handlers.forEach(function(r){r.call(e,t)})},enumerable:!1,configurable:!1,writable:!1},unsubscribe:{value:function(e){this.handlers=this.handlers.filter(function(t){if(t!==e)return t})},enumerable:!1,configurable:!1,writable:!1}}),XHR.prototype=Object.create(Object.prototype,{constructor:XHR,init:{value:function(){this.xhr=new XMLHttpRequest,this.xhr.open(this.item.method,this.item.url,!0),this.xhr.withCredentials=this.item.withCredentials,this.events.onSuccess=new Observable,this.events.onProgress=new Observable,this.events.onComplete=new Observable,this.events.onError=new Observable,this.events.onCancel=new Observable},enumerable:!1,configurable:!1,writable:!0},apply:{value:function(e,t){for(var r in t)e[r]=t[r]},enumerable:!1,configurable:!1,writable:!1},item:{writable:!0,configurable:!1,value:null},events:{writable:!0,configurable:!1,value:{onSuccess:null,onProgress:null,onComplete:null,onError:null,onCancel:null}},_isRequestSuccessful:{value:function(){return 0==this.xhr.status||this.xhr.status>=200&&this.xhr.status<300||304==this.xhr.status||1223==this.xhr.status},enumerable:!1,configurable:!1,writable:!0},_parseHeaders:{value:function(e){var t,r,n={};return e?(e.split("\n").forEach(function(e){var a=e.split(":");t=a[0].trim().toLowerCase(),r=a[1].trim().replace(/"/g,""),t&&(n[t]=n[t]?n[t]+", "+r:r)}),n):n},enumerable:!1,configurable:!1,writable:!0},_onSuccess:{value:function(e,t,r,n){this.events.onSuccess.publish(e,t,r,n)},enumerable:!1,configurable:!1,writable:!0},_onProgress:{value:function(e,t){this.events.onProgress.publish(e,t)},enumerable:!1,configurable:!1,writable:!0},_onComplete:{value:function(e,t,r,n){this.events.onComplete.publish(e,t,r,n)},enumerable:!1,configurable:!1,writable:!0},_onError:{value:function(e,t,r,n){this.events.onError.publish(e,t,r,n)},enumerable:!1,configurable:!1,writable:!0},_onCancel:{value:function(e,t,r,n){this.events.onCancel.publish(e,t,r,n)},enumerable:!1,configurable:!1,writable:!0},addListeners:{value:function(){var e=this;this.xhr.upload.onprogress=function(t){var r=Math.round(t.lengthComputable?100*t.loaded/t.total:0);this._onProgress(e.item,r)},this.xhr.onload=function(){if(this.readyState===this.DONE){var t=JSON.parse(this.responseText),r=e._parseHeaders(this.getAllResponseHeaders()),n=(e.isRequestSuccessful(),"Success");e[n](e.item,t,this.status,r),e._onComplete(e.item,t,this.status,r)}},this.xhr.onerror=function(){var t=JSON.parse(this.responseText),r=e._parseHeaders(this.getAllResponseHeaders());e._onError(e.item,t,this.status,r),e._onComplete(e.item,t,this.status,r)},this.xhr.onabort=function(){var t=JSON.parse(this.responseText),r=e._parseHeaders(this.getAllResponseHeaders());e._onCancel(e.item,t,this.status,r),e._onComplete(e.item,t,this.status,r)}},enumerable:!1,configurable:!1,writable:!0},send:{value:function(e){var t=this;this.item.headers.forEach(function(e){t.xhr.setRequestHeader(e.name,e.value)}),this.xhr.send(e)},enumerable:!1,configurable:!1,writable:!0}}),function(e){"use strict";var t={WAIT:0,SENDING:1,FINISHED:2,ERROR:3,PAUSED:4};e.module("s3chunkfile",["s3object","s3eventtarget"]).factory("s3chunkfile",function(e,r){function n(t){e.call(this),this.apply(this,t)}return n.prototype=Object.create(e.prototype,{constructor:n,bytesSent:{writable:!0,configurable:!1,value:null},state:{writable:!0,configurable:!1,value:t.WAIT},retries:{writable:!0,configurable:!1,value:0},maxretry:{writable:!0,configurable:!0,value:5},blob:{writable:!0,configurable:!0,value:null},signedUrl:{writable:!0,configurable:!0,value:null},multipartProperties:{writable:!0,configurable:!0,value:null},partNumber:{writable:!0,configurable:!0,value:null},etag:{writable:!0,configurable:!0,value:null},upload:{writable:!1,configurable:!1,value:{startsend:null,urlsigned:null,finished:null,progress:null,error:null}},init:{value:function(){this.upload.startsend=r(),this.upload.urlsigned=r(),this.upload.finished=r(),this.upload.progress=r(),this.upload.error=r()},enumerable:!1,configurable:!0,writable:!0},addListeners:{value:function(){var e=this;this.upload.startsend.addListener(function(t){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE&&200===this.status){var r=JSON.parse(this.responseText);t.signedUrl=r.data.Url,t.upload.urlsigned.fire(e,t)}};var n={UploadId:t.multipartProperties.uploadId,Key:t.multipartProperties.key,partNumber:t.partNumber,ContentLength:t.blob.size};r.open("POST",t.multipartProperties.signUrl,!0),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(JSON.stringify(n))}),this.upload.urlsigned.addListener(function(r){var n=new XMLHttpRequest;n.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&200===this.status&&(r.etag=this.getResponseHeader("ETag").replace(/"/g,""),r.upload.finished.fire(e,r))},n.upload.error=function(n){r.state=t.ERROR,r.upload.error.fire(e,r)},n.upload.onprogress=function(n){n.lengthComputable&&(r.state=t.SENDING,r.bytesSent=n.loaded,r.upload.progress.fire(e,r))},n.open("PUT",r.signedUrl,!0),n.send(r.blob)}),this.upload.finished.addListener(function(e){e.state=t.FINISHED})},enumerable:!1,configurable:!0,writable:!0},send:{value:function(){this.upload.startsend.fire(this,this)}},retry:{value:function(){this.retries<this.maxretry?(this.retries++,this.upload.startsend.fire(this,this)):this.state=t.PAUSED}}}),function(e){return new n(e)}}).constant("s3chunkfilestate",t)}(window.angular),function(e){"use strict";e.module("s3multipartproperties",["s3object"]).factory("s3multipartproperties",function(e){function t(t){e.call(this),this.apply(this,t)}return t.prototype=Object.create(e.prototype,{constructor:t,key:{writable:!0,configurable:!0,value:null},uploadId:{writable:!0,configurable:!0,value:null},signUrl:{writable:!0,configurable:!0,value:null}}),function(e){return new t(e)}})}(window.angular),function(e){"use strict";e.module("s3uploadetag",["s3object"]).factory("s3uploadetag",function(e){function t(t){e.call(this),this.apply(this,t)}return t.prototype=Object.create(e.prototype,{constructor:t,ETag:{writable:!0,configurable:!0,value:null},PartNumber:{writable:!0,configurable:!0,value:null}}),function(e){return new t(e)}})}(window.angular),function(e){"use strict";var t=["s3object","s3eventtarget","s3queue","s3stack","s3uploadmultipartconfig","s3multipartproperties","s3chunkfile","s3uploadetag"];e.module("s3uploadmultipart",t).factory("s3uploadmultipart",function(e,t,r,n,a,i,l,u,s){function o(t){e.call(this),this.apply(this.config,t)}return o.prototype=Object.create(e.prototype,{constructor:o,totalBytesSent:{writable:!0,configurable:!1,value:null},percentageSent:{configurable:!1,get:function(){return parseInt(this.totalBytesSent/this.config.blob.size*100,10)}},config:{writable:!0,configurable:!0,value:null},chunks:{writable:!0,configurable:!1,value:null},etags:{writable:!0,configurable:!1,value:null},multipartProperties:{writable:!0,configurable:!0,value:null},upload:{writable:!0,configurable:!0,value:{create:null,progress:null,send:null,completed:null,abort:null}},PART_SIZE:{configurable:!1,get:function(){return 1024*this.config.chunkSize*1024}},init:{value:function(){this.upload.create=t(),this.upload.progress=t(),this.upload.send=t(),this.upload.completed=t(),this.upload.abort=t(),this.chunks=r(),this.etags=r(),this.config=a(),this.multipartProperties=i()},enumerable:!1,configurable:!0,writable:!0},addListeners:{value:function(){var e=this;this.upload.progress.addListener(function(t){e.totalBytesSent=e.PART_SIZE*(t.partNumber-1)+t.bytesSent}),this.upload.send.addListener(function(){if(!e.chunks.empty){var t=e.chunks.peek();t.state===s.WAIT&&t.send()}}),this.upload.send.addListener(function(t){t.empty&&e.complete()}),this.upload.create.addListener(function(){for(var t=0,r=0,n=e.config.blob.size,a=e.config.blob;r<n;){t=e.PART_SIZE*e.chunks.length,r=Math.min(e.PART_SIZE*(e.chunks.length+1),n);var i=l({blob:a.slice(t,r),multipartProperties:e.multipartProperties,partNumber:e.chunks.length+1});i.upload.progress.addListener(function(t){t.state===s.SENDING&&e.upload.progress.fire(e,t)}),i.upload.finished.addListener(function(e){e.state===s.ERROR&&e.retry()}),i.upload.finished.addListener(function(t){t.state===s.FINISHED&&e.chunks.dequeue()}),i.upload.finished.addListener(function(t){t.state===s.FINISHED&&e.etags.push(u({ETag:t.etag,PartNumber:t.partNumber}))}),i.upload.finished.addListener(function(t){t.state===s.FINISHED&&e.upload.send.fire(e,e.chunks)}),e.chunks.enqueue(i)}e.upload.send.fire(e,e.chunks)})},enumerable:!0,configurable:!0,writable:!0},retry:{value:function(){me.upload.send.fire(me,me.chunks)},configurable:!1},create:{value:function(){var e=this;e.chunks.clear(),e.etags.clear();var t=new XMLHttpRequest;t.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE&&200===this.status){var t=JSON.parse(this.responseText);e.multipartProperties.key=t.data.Key,e.multipartProperties.uploadId=t.data.UploadId,e.multipartProperties.signUrl=e.config.signUrl,e.upload.create.fire(e,e)}};var r={Context:e.config.context,FileName:e.config.blob.name,ContentType:e.config.blob.type};t.open("POST",e.config.createMultiPartUrl,!0),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(JSON.stringify(r))}},complete:{value:function(){var e=this,t=new XMLHttpRequest;t.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE&&200===this.status){var t=JSON.parse(this.responseText);e.upload.completed.fire(e,t)}};var r={UploadId:e.multipartProperties.uploadId,Key:e.multipartProperties.key,Etags:e.etags.elements};t.open("POST",e.config.completeMultiPartUrl,!0),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(JSON.stringify(r))}},abort:{value:function(){var e=this,t=new XMLHttpRequest;t.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE&&200===this.status){var t=JSON.parse(this.responseText);e.upload.abort.fire(e,t)}};var r={UploadId:e.multipartProperties.uploadId,Key:e.multipartProperties.key};t.open("POST",e.config.abortMultiPartUrl,!0),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(JSON.stringify(r))}}}),function(e){return new o(e)}})}(window.angular),function(e){"use strict";e.module("s3uploadmultipartconfig",["s3object"]).factory("s3uploadmultipartconfig",function(e){function t(t){e.call(this),this.apply(this,t)}return t.prototype=Object.create(e.prototype,{constructor:t,context:{writable:!0,configurable:!0,value:""},blob:{writable:!0,configurable:!0,value:null},chunkSize:{writable:!0,configurable:!0,value:10},createMultiPartUrl:{writable:!0,configurable:!0,value:""},completeMultiPartUrl:{writable:!0,configurable:!0,value:""},abortMultiPartUrl:{writable:!0,configurable:!0,value:""},signUrl:{writable:!0,configurable:!0,value:""}}),function(e){return new t(e)}})}(window.angular),Queue.prototype=Object.create(Object.prototype,{constructor:Queue,init:{value:function(){},enumerable:!1,configurable:!0,writable:!1},apply:{value:function(e,t){for(var r in t)e[r]=t[r]},enumerable:!1,configurable:!1,writable:!1},enqueue:{value:function(e){this.dataStore.push(e)},configurable:!1},dequeue:{value:function(){return this.dataStore.shift()},configurable:!1},front:{value:function(){return this.dataStore[0]},configurable:!1},back:{value:function(){return this.dataStore[this.dataStore.length-1]},configurable:!1},length:{get:function(){return this.top},configurable:!1},empty:{get:function(){return 0==this.dataStore.length},configurable:!1},clear:{value:function(){this.top=0,this.dataStore=[]},configurable:!1}}),Stack.prototype=Object.create(Object.prototype,{constructor:Stack,init:{value:function(){},enumerable:!1,configurable:!0,writable:!1},apply:{value:function(e,t){for(var r in t)e[r]=t[r]},enumerable:!1,configurable:!1,writable:!1},push:{value:function(e){this.dataStore[this.top++]=e},configurable:!1},pop:{value:function(){return this.dataStore[--this.top]},configurable:!1},peek:{value:function(){return this.dataStore[this.top-1]},configurable:!1},length:{get:function(){return this.top},configurable:!1},empty:{get:function(){return 0==this.dataStore.length},configurable:!1},clear:{value:function(){this.top=0},configurable:!1}});